# Batch Timer

macOSã§ç‰¹å®šã®æ™‚åˆ»ã«æ¯æ—¥shellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è‡ªå‹•å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚cronå½¢å¼ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç°¡å˜ã«è¨­å®šã§ãã¾ã™ã€‚

## ç‰¹å¾´

- ğŸ• cronå½¢å¼ã§æŸ”è»Ÿã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®š
- ğŸ“ å®Ÿè¡Œãƒ­ã‚°ã‚’è‡ªå‹•è¨˜éŒ²
- ğŸ”” ã‚¿ã‚¹ã‚¯å®Ÿè¡Œæ™‚ã«é€šçŸ¥ã‚’è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- ğŸš€ ç°¡å˜ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
batch-timer/
â”œâ”€â”€ crontab.txt                       # cronå½¢å¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ daily-task.sh                 # å®Ÿè¡Œã•ã‚Œã‚‹ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ setup.sh                      # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ uninstall.sh                  # ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ README.md
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®š

`crontab.txt`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€cronå½¢å¼ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã™ï¼š

```
# åˆ† æ™‚ æ—¥ æœˆ æ›œæ—¥ ã‚³ãƒãƒ³ãƒ‰
0 9 * * * /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh
```

**Cronå½¢å¼ã®èª¬æ˜:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€ åˆ† (0 - 59)
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€ æ™‚ (0 - 23)
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€ æ—¥ (1 - 31)
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€ æœˆ (1 - 12)
â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€ æ›œæ—¥ (0 - 6) (0=æ—¥æ›œæ—¥)
â”‚ â”‚ â”‚ â”‚ â”‚
* * * * *
```

**ã‚ˆãä½¿ã†è¨­å®šä¾‹:**
```bash
# æ¯æ—¥9:00ã«å®Ÿè¡Œ
0 9 * * * /path/to/script.sh

# æ¯æ—¥22:30ã«å®Ÿè¡Œ
30 22 * * * /path/to/script.sh

# æœˆæ›œã‹ã‚‰é‡‘æ›œã®12:00ã«å®Ÿè¡Œ
0 12 * * 1-5 /path/to/script.sh

# 6æ™‚é–“ã”ã¨ã«å®Ÿè¡Œ
0 */6 * * * /path/to/script.sh

# æ¯æœˆ1æ—¥ã®0:00ã«å®Ÿè¡Œ
0 0 1 * * /path/to/script.sh

# å¹³æ—¥ã®9:00ã¨18:00ã«å®Ÿè¡Œï¼ˆè¤‡æ•°è¡Œã§è¨­å®šï¼‰
0 9 * * 1-5 /path/to/script.sh
0 18 * * 1-5 /path/to/script.sh
```

### 2. å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

`scripts/daily-task.sh`ã‚’ç·¨é›†ã—ã¦ã€å®Ÿè¡Œã—ãŸã„å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ï¼š

```bash
#!/bin/bash

# ã“ã“ã«å®Ÿè¡Œã—ãŸã„å‡¦ç†ã‚’è¨˜è¿°
# ä¾‹ï¼š
# - ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
# - ãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆ
# - ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
# - é€šçŸ¥ã®é€ä¿¡ãªã©

echo "ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ" >> "$LOG_FILE"
```

### 3. launchdã¸ã®ç™»éŒ²

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```bash
./scripts/setup.sh
```

æˆåŠŸã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼
â° crontab.txtã§è¨­å®šã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™
```

## å‹•ä½œç¢ºèª

### ç™»éŒ²çŠ¶æ…‹ã®ç¢ºèª

```bash
crontab -l
```

batch-timerã®è¨­å®šè¡Œã«ã¯ `# batch-timer` ã¨ã„ã†ãƒãƒ¼ã‚«ãƒ¼ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚

### ãƒ­ã‚°ã®ç¢ºèª

å®Ÿè¡Œãƒ­ã‚°ã¯ä»¥ä¸‹ã®å ´æ‰€ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼š

```bash
# ãƒ¡ã‚¤ãƒ³ãƒ­ã‚°
~/Library/Logs/batch-timer/daily-task.log

# æ¨™æº–å‡ºåŠ›ãƒ­ã‚°
~/Library/Logs/batch-timer/stdout.log

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
~/Library/Logs/batch-timer/stderr.log
```

ãƒ­ã‚°ã‚’ç¢ºèªï¼š

```bash
tail -f ~/Library/Logs/batch-timer/daily-task.log
```

### æ‰‹å‹•ã§ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ãƒ†ã‚¹ãƒˆ

```bash
./scripts/daily-task.sh
```

### cronãƒ­ã‚°ã®ç¢ºèªï¼ˆã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ï¼‰

```bash
# macOSã®ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‹ã‚‰cronã®å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèª
log show --predicate 'process == "cron"' --last 1h --info
```

## ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

å®šæœŸã‚¿ã‚¹ã‚¯ã‚’åœæ­¢ãƒ»å‰Šé™¤ã™ã‚‹å ´åˆï¼š

```bash
./scripts/uninstall.sh
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œãªã„å ´åˆ

1. **ç™»éŒ²çŠ¶æ…‹ã‚’ç¢ºèª**
   ```bash
   crontab -l | grep batch-timer
   ```

2. **crontab.txtã®ãƒ‘ã‚¹ã‚’ç¢ºèª**
   - ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¸ã®çµ¶å¯¾ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ç¢ºèª
   - `crontab.txt`å†…ã®ãƒ‘ã‚¹ã‚’å®Ÿéš›ã®ãƒ‘ã‚¹ã«ç½®ãæ›ãˆã¦ã„ã‚‹ã‹ç¢ºèª

3. **ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ¨©é™ã‚’ç¢ºèª**
   ```bash
   ls -la scripts/daily-task.sh
   ```
   `-rwxr-xr-x`ã®ã‚ˆã†ã«å®Ÿè¡Œæ¨©é™ï¼ˆxï¼‰ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

4. **Full Disk Accessã®è¨±å¯ï¼ˆmacOS Catalinaä»¥é™ï¼‰**
   
   macOS Catalinaä»¥é™ã§ã¯ã€cronã«Full Disk Accessã®æ¨©é™ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ï¼š
   
   - ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒè¨­å®š > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ > ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼
   - ã€Œãƒ•ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã€ã‚’é¸æŠ
   - éµã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å¤‰æ›´ã‚’è¨±å¯
   - ã€Œ+ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - `Shift + Command + G` ã§ `/usr/sbin/cron` ã«ç§»å‹•ã—ã¦è¿½åŠ 

5. **ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’ç¢ºèª**
   
   cronã¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã¨ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã™ï¼š
   ```bash
   mail
   ```

6. **å†ç™»éŒ²**
   ```bash
   ./scripts/uninstall.sh
   ./scripts/setup.sh
   ```

### é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ

ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒè¨­å®š > é€šçŸ¥ã§ã€ŒScript Editorã€ã¾ãŸã¯ã€Œã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã€ã®é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹

### è¤‡æ•°ã®æ™‚åˆ»ã«å®Ÿè¡Œã™ã‚‹

`crontab.txt`ã«è¤‡æ•°ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ï¼š

```bash
# æ¯æ—¥9:00ã«å®Ÿè¡Œ
0 9 * * * /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh

# æ¯æ—¥18:00ã«ã‚‚å®Ÿè¡Œ
0 18 * * * /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh
```

### ç‰¹å®šã®æ›œæ—¥ã®ã¿å®Ÿè¡Œã™ã‚‹

```bash
# æœˆæ›œæ—¥ã‹ã‚‰é‡‘æ›œæ—¥ã®9:00ã®ã¿å®Ÿè¡Œ
0 9 * * 1-5 /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh

# åœŸæ›œæ—¥ã®10:00ã«å®Ÿè¡Œ
0 10 * * 6 /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh
```

### æ¯æ™‚å®Ÿè¡Œ

```bash
# æ¯æ™‚0åˆ†ã«å®Ÿè¡Œ
0 * * * * /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh

# 30åˆ†ã”ã¨ã«å®Ÿè¡Œ
*/30 * * * * /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh
```

### ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦å®Ÿè¡Œ

```bash
# PATHç’°å¢ƒå¤‰æ•°ã‚’æŒ‡å®š
0 9 * * * PATH=/usr/local/bin:/usr/bin:/bin /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh

# ã¾ãŸã¯ã€crontab.txtã®å…ˆé ­ã«ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©
# PATH=/usr/local/bin:/usr/bin:/bin
# 0 9 * * * /Users/rchaser53/Desktop/batch-timer/scripts/daily-task.sh
```

## æ³¨æ„äº‹é …

- macOSãŒã‚¹ãƒªãƒ¼ãƒ—çŠ¶æ…‹ã®å ´åˆã€ã‚¿ã‚¹ã‚¯ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“
- æŒ‡å®šæ™‚åˆ»ã«MacãŒèµ·å‹•ã—ã¦ã„ãªã„å ´åˆã€æ¬¡ã®æŒ‡å®šæ™‚åˆ»ã¾ã§å¾…æ©Ÿã—ã¾ã™
- cronã¯ç’°å¢ƒå¤‰æ•°ãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„
- ã‚·ã‚¹ãƒ†ãƒ ã‚’å†èµ·å‹•ã—ã¦ã‚‚crontabã®è¨­å®šã¯ä¿æŒã•ã‚Œã¾ã™
- macOS Catalinaä»¥é™ã§ã¯ã€cronã«é©åˆ‡ãªæ¨©é™ã‚’ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

## Cron vs Launchd

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯cronã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€macOSã§ã¯`launchd`ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

**Cronã‚’ä½¿ã†åˆ©ç‚¹:**
- ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„è¨­å®š
- UNIX/Linuxç³»OSã§åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹æ¨™æº–çš„ãªæ–¹æ³•
- ä»–ã®ã‚·ã‚¹ãƒ†ãƒ ã«ç§»è¡Œã—ã‚„ã™ã„

**Launchdã‚’ä½¿ã†åˆ©ç‚¹:**
- macOSãƒã‚¤ãƒ†ã‚£ãƒ–ã®ä»•çµ„ã¿
- ã‚ˆã‚Šè©³ç´°ãªãƒ­ã‚°ç®¡ç†
- ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•æ™‚ã®è‡ªå‹•å®Ÿè¡Œãªã©æŸ”è»Ÿãªè¨­å®š

å¿…è¦ã«å¿œã˜ã¦`launchd`ç‰ˆã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- [Crontab Generator](https://crontab.guru/) - Cronå¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
- [crontab man page](https://man7.org/linux/man-pages/man5/crontab.5.html)
